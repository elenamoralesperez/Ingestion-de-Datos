Paso 1: InvokeHTTP (Descargar datos)
Este es el que hace la llamada a la web de vuelos.

InvokeHTTP - PROPERTIES - HTTP URL - API Key de AviationStack



Paso 2: SplitJson (Cortar los datos)
Este separa el archivo gigante en un archivo por cada vuelo.

SplitJson - PROPERTIES - Json Path Expression - $.data



Paso 3: PutMongo (Guardar en Base de Datos)
Este guarda cada vuelo en MongoDB.

PutMongo - PROPERTIES - 
Mongo Database Name: aviation
Mongo Collection Name: flights

Para la URL:
Crear el Servicio de Conexi√≥n
En esa misma pantalla de tu captura, haz clic en el hueco vac√≠o a la derecha de Client Service (donde dice No value set).
En el men√∫ que se abre, elige Create new service...
Selecciona MongoDBControllerService y dale al bot√≥n Create.
Justo al lado del nombre del servicio que acabas de crear, ver√°s un icono de una flecha peque√±a (‚û°Ô∏è) o una llave inglesa.
Te pedir√° guardar los cambios del procesador (Save changes before going to Controller Service?). S√ç.
Te llevar√° a una lista de servicios. Ver√°s el tuyo ah√≠. Haz clic en el icono del Engranaje (‚öôÔ∏è) de la derecha para editarlo.
Pesta√±a PROPERTIES.
Casilla Mongo URI.
APPLY.
El servicio est√° creado pero "apagado".
En la lista de servicios, busca el icono del Rayo (‚ö°) a la derecha de tu servicio.
Dale a Enable.



Paso 4: EvaluateJsonPath (Sacar informaci√≥n)
Este busca a qu√© aeropuerto llega el vuelo y lo apunta en una "etiqueta" invisible.

EvaluateJsonPath - PROPERTIES - Seleccionar: flowfile-attribute - + (New Property)
Property Name: arrival_airport
Value: $.arrival.iata



Paso 5: UpdateAttribute (Renombrar archivo)
Este cambia el nombre del archivo para que no se sobreescriban.

UpdateAttribute - PROPERTIES - + (New Property).
Property Name: filename
Value: flight-${arrival_airport}-${now():toNumber()}.json
(now() para generar un n√∫mero √∫nico basado en la hora, es m√°s f√°cil que el secuencial).



Paso 6: RouteOnAttribute (El Sem√°foro)
Este decide si va a la carpeta de Madrid o Barcelona.

RouteOnAttribute - PROPERTIES - Boton +
Name: madrid
Value: ${arrival_airport:equals('MAD')}

Otra vez al bot√≥n +
Name: barcelona
Value: ${arrival_airport:equals('BCN')}



Paso 7: PutFile (Guardar en carpetas)
Aqu√≠ tendr√°s dos cajitas PutFile.

Para la cajita de Madrid:
PutFile - Properties - Directory: /tmp/data/madrid

Para la cajita de Barcelona:
Otro PutFile - Properties - Directory: /tmp/data/barcelona



üîåLas Conexiones (Flechas)

1. De InvokeHTTP a SplitJson -> Marca la casilla Response.
(En InvokeHTTP, ve a la pesta√±a Relationships y marca "Auto-terminate" en todas las dem√°s: Original, Failure, Retry, No Retry).

2. De SplitJson a PutMongo -> Marca split.
(Auto-terminate: original, failure).

3. De PutMongo a EvaluateJsonPath -> Marca success.
(Auto-terminate: failure).

4. De EvaluateJsonPath a UpdateAttribute -> Marca matched.
(Auto-terminate: failure, unmatched).

5. De UpdateAttribute a RouteOnAttribute -> Marca success.

6. De RouteOnAttribute a PutFile (Madrid) -> Marca madrid.

7. De RouteOnAttribute a PutFile (Barcelona) -> Marca barcelona.
(En RouteOnAttribute, Auto-terminate: unmatched).

8. En los dos PutFile, ve a Relationships y haz Auto-terminate en success y failure (porque aqu√≠ acaba el flujo).